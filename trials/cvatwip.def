BootStrap: debootstrap
OSVersion: bionic
MirrorURL: http://us.archive.ubuntu.com/ubuntu/



%post
    # apt-get -y install sudo
    apt-get -y install software-properties-common
    echo "Hello from inside the container"
    sed -i 's/$/ universe/' /etc/apt/sources.list
    add-apt-repository ppa:mc3man/bionic-media
    apt-get update
    apt-get -y install vim python3 supervisor ffmpeg libldap2-dev \
        libsasl2-dev \
        python3-dev \
        python3-pip \
        tzdata \
        p7zip-full \
        git \
        ssh \
        poppler-utils \
        curl \
	postgresql postgresql-contrib postgresql-client \
	redis redis-tools

# apt-get clean

# %appinstall postgres
# this is postgres 10 with ubuntu 18.04, do I need the client libraries?
   if getent passwd django > /dev/null 2>&1; then
      echo "yes the user exists"
   else
      echo "No, the user does not exist"
      adduser django --disabled-password   
   fi
   
   su - django
   su - -c "mkdir -p data share keys log /tmp/supervisord" django 
   # mkdir data share keys logs /tmp/supervisord
   # mkdir media
   pip3 install django
   
# %appinstall redis



# %appinstall cvatdjango

%files
  /home/clee/code/eegml/cvat/cvat  /root/cvat






%startscript
    # /etc/init.d/postgresql start
    service postgresql start
    echo "ran start script"


%runscript
    echo "This is what happens when you run the container..."
    /bin/bash -i

# these are some of the standard postgres environment variables
#export PGUSER="cleemess"
#export PGSSLMODE="require"
#export PGSSLCERT="/home/cleemess/database-creds/cleemess.crt"
#export PGSSLKEY="/home/cleemess/database-creds/cleemess-nopwd.key"
#export PGHOST="postgres-gen.cleemess-pi.svc.cluster.local"

e# xport PGPORT=5432
# example not used by default
# export PGDATABASE="postgres" 
